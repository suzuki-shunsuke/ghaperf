# ghaperf

**ghaperf** analyzes the performance of GitHub Actions workflows using GitHub API and raw job logs. Unlike other tools, it can detect bottlenecks **inside composite actions** by parsing job logs and extracting step-level timing data.

## Why ghaperf?

1. [Existing tools](#related-projects) can't detect bottlenecks inside steps. ghaperf solves this by analyzing actions logs.
1. Many existing tools need metrics storage, so the setup is bothersome and it costs ðŸ’¸. ghaperf doesn't need any storage, so it's easy to use and free

## Key Features

- **Deep visibility into composite actions** - Detect bottlenecks inside composite actions that other tools miss
- **No infrastructure needed** - Just a CLI tool, no backend or metrics storage required
- Multiple analysis modes - Analyze workflows, workflow runs, or individual jobs
- Markdown reports - Generate shareable performance reports
- Intelligent caching - Cache GitHub API responses for completed runs to speed up analysis
- Flexible filtering - Filter and normalize job names using configuration files

## Quick Start

1. [Install ghaperf](INSTALL.md)
1. [Set your GitHub Access token to download action logs](#github-access-token)
1. Run ghaperf

```sh
export GITHUB_TOKEN=xxx

# Analyze a workflow across multiple runs
ghaperf --repo aquaproj/aqua-registry --workflow test.yaml --count 10 --threshold 2s
```

### Example Report

<details>
<summary>Example Report Output</summary>

[_This report was generated by ghaperf._](https://github.com/suzuki-shunsuke/ghaperf)
<table>
<tr><td>ghaperf version</td><td><a href="https://github.com/suzuki-shunsuke/ghaperf/releases/tag/v0.1.1">v0.1.1</a></td></tr>
<tr><td>Created At</td><td>2025-11-02T21:03:34+09:00</td></tr>
<tr><td>Threshold</td><td>2s</td></tr>
<tr><td>Repository</td><td><a href="https://github.com/aquaproj/aqua-registry">aquaproj/aqua-registry</a></td></tr>
<tr><td>The Number of Workflow Runs</td><td>10</td></tr>
<tr><td>Workflow Name</td><td>test.yaml</td></tr>
</table>

## Job: test / test / test (macos-13)
<table>
<tr><td>Average Job Duration</td><td>1m15s (11m11s/9)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284198226">8m25s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19008352862/job/54285609922">24s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010028182/job/54289608586">23s</a></td></tr>
</table>

### Slow steps
1. 1m4s (8m31s/8): Run aquaproj/registry-action/test@68f10339de561d67f9acea40b91dc36aa5011ea8
    1. 1m36s (7m58s/5): Run aqua i --test
    2. 16s (16s/1): Run rustup update
2. 6s (48s/8): Set up job
    1. 6s (49s/8): GITHUB_TOKEN Permissions
3. 4s (30s/8): Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
4. 4s (29s/8): Run aquaproj/aqua-installer@ea518c135a02fc11ff8024364510c181a5c6b342
    1. 3s (21s/8): Run if [ "${SKIP_INSTALL_AQUA:-}" = true ] && command -v aqua >/dev/null; then
## Job: test / test / test (windows-latest, arm64)
<table>
<tr><td>Average Job Duration</td><td>1m6s (10m59s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284198228">6m19s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010325783/job/54290299340">41s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19011690964/job/54293534282">39s</a></td></tr>
</table>

### Slow steps
1. 36s (5m57s/10): Run aquaproj/registry-action/test@68f10339de561d67f9acea40b91dc36aa5011ea8
    1. 5m4s (5m4s/1): Run aqua i --test
    2. 18s (18s/1): Run rustup update
    3. 2s (17s/8): Run aqua exec -- ci-info run | sed -E "s/^export //" >> "$GITHUB_ENV"
2. 13s (2m10s/10): Run aquaproj/aqua-installer@ea518c135a02fc11ff8024364510c181a5c6b342
    1. 11s (1m25s/8): Run $(if($env:AQUA_ROOT_DIR) {echo $env:AQUA_ROOT_DIR} else {echo "$HOME/AppData/Local/aquaproj-aqua/bin"}) | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
    2. 4s (36s/8): Run if [ "${SKIP_INSTALL_AQUA:-}" = true ] && command -v aqua >/dev/null; then
3. 8s (1m23s/10): Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
    1. 2s (23s/10): Setting up auth
4. 4s (38s/10): Set up job
    1. 4s (37s/10): GITHUB_TOKEN Permissions
5. 2s (23s/10): Post Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
    1. 3s (18s/7): Run aqua i --test
    2. 6s (6s/1): Run $(if($env:AQUA_ROOT_DIR) {echo $env:AQUA_ROOT_DIR} else {echo "$HOME/AppData/Local/aquaproj-aqua/bin"}) | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
    3. 5s (5s/1): Checking out the ref
## Job: test / test / test (windows-latest)
<table>
<tr><td>Average Job Duration</td><td>1m4s (10m36s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284198237">6m0s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19011690964/job/54293534276">37s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007985159/job/54284726467">36s</a></td></tr>
</table>

### Slow steps
1. 34s (5m43s/10): Run aquaproj/registry-action/test@68f10339de561d67f9acea40b91dc36aa5011ea8
    1. 4m44s (4m44s/1): Run aqua i --test
    2. 20s (20s/1): Run rustup update
    3. 2s (17s/8): Run aqua exec -- ci-info run | sed -E "s/^export //" >> "$GITHUB_ENV"
    4. 2s (13s/6): Run if grep '\- import:' aqua/test.yaml | sed 's|  - import: ../\(.*\)/pkg.yaml|\1/registry.yaml|' | xargs cat | grep "type: cargo" > /dev/null 2>&1; then
2. 13s (2m9s/10): Run aquaproj/aqua-installer@ea518c135a02fc11ff8024364510c181a5c6b342
    1. 10s (1m22s/8): Run $(if($env:AQUA_ROOT_DIR) {echo $env:AQUA_ROOT_DIR} else {echo "$HOME/AppData/Local/aquaproj-aqua/bin"}) | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
    2. 5s (40s/8): Run if [ "${SKIP_INSTALL_AQUA:-}" = true ] && command -v aqua >/dev/null; then
3. 7s (1m12s/10): Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
    1. 2s (22s/10): Setting up auth
4. 4s (39s/10): Set up job
    1. 4s (39s/10): GITHUB_TOKEN Permissions
5. 2s (23s/10): Post Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
    1. 3s (18s/7): Run aqua i --test
    2. 5s (5s/1): Run $(if($env:AQUA_ROOT_DIR) {echo $env:AQUA_ROOT_DIR} else {echo "$HOME/AppData/Local/aquaproj-aqua/bin"}) | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append
    3. 5s (5s/1): Checking out the ref
## Job: test / test / test (macos-14)
<table>
<tr><td>Average Job Duration</td><td>34s (5m40s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284198230">2m52s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19009066123/job/54292785812">26s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010028182/job/54289608576">21s</a></td></tr>
</table>

### Slow steps
1. 19s (3m7s/10): Run aquaproj/registry-action/test@68f10339de561d67f9acea40b91dc36aa5011ea8
    1. 39s (2m37s/4): Run aqua i --test
    3. 10s (10s/1): Run rustup update
2. 6s (55s/10): Set up job
    1. 5s (55s/10): GITHUB_TOKEN Permissions
3. 3s (30s/10): Run aquaproj/aqua-installer@ea518c135a02fc11ff8024364510c181a5c6b342
    1. 2s (24s/10): Run if [ "${SKIP_INSTALL_AQUA:-}" = true ] && command -v aqua >/dev/null; then
4. 2s (21s/10): Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
## Job: test / test / test (ubuntu-24.04)
<table>
<tr><td>Average Job Duration</td><td>28s (4m42s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284198231">2m46s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19009066123/job/54292785795">18s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19008352862/job/54285609920">15s</a></td></tr>
</table>

### Slow steps
1. 19s (3m5s/10): Run aquaproj/registry-action/test@68f10339de561d67f9acea40b91dc36aa5011ea8
    1. 32s (2m40s/5): Run aqua i --test
    3. 9s (9s/1): Run rustup update
2. 3s (31s/10): Set up job
    1. 3s (32s/10): GITHUB_TOKEN Permissions
## Job: test / test / test (ubuntu-24.04-arm)
<table>
<tr><td>Average Job Duration</td><td>27s (4m32s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284198225">2m30s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19011275343/job/54292555092">16s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010028182/job/54289608580">16s</a></td></tr>
</table>

### Slow steps
1. 16s (2m43s/10): Run aquaproj/registry-action/test@68f10339de561d67f9acea40b91dc36aa5011ea8
    1. 22s (2m13s/6): Run aqua i --test
    3. 7s (7s/1): Run rustup update
2. 3s (31s/10): Set up job
    1. 3s (31s/10): GITHUB_TOKEN Permissions
3. 2s (24s/10): Run aquaproj/aqua-installer@ea518c135a02fc11ff8024364510c181a5c6b342
## Job: test / lintnet / lintnet
<table>
<tr><td>Average Job Duration</td><td>15s (2m34s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007985159/job/54284721578">19s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19011275343/job/54292551896">18s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010325783/job/54290295731">18s</a></td></tr>
</table>

### Slow steps
1. 6s (59s/10): Run lintnet lint
    1. 8s (1m5s/8): Run lintnet lint
2. 3s (30s/10): Run aquaproj/aqua-installer@ea518c135a02fc11ff8024364510c181a5c6b342
3. 2s (22s/10): Post Run actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8
## Job: test / ci-info / ci-info
<table>
<tr><td>Average Job Duration</td><td>9s (1m33s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19011690964/job/54293528851">12s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007985159/job/54284721572">12s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010325783/job/54290295716">10s</a></td></tr>
</table>

### Slow steps
1. 2s (22s/10): Run suzuki-shunsuke/ci-info-action/store@ceeb10dd50cd632db31e7eccf92cbbb6856f3191
## Job: test / check-files / check-files
<table>
<tr><td>Average Job Duration</td><td>5s (54s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19008352862/job/54285608329">7s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19011275343/job/54292553750">6s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010325783/job/54290298001">6s</a></td></tr>
</table>

The job has no slow steps
## Job: test / path-filter
<table>
<tr><td>Average Job Duration</td><td>4s (40s/10)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19007740980/job/54284194236">6s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19010325783/job/54290295719">5s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19009062660/job/54292789410">5s</a></td></tr>
</table>

The job has no slow steps
## Job: status-check
<table>
<tr><td>Average Job Duration</td><td>4s (7s/2)</td></tr>
<tr><td>Slowest Jobs</td><td><a href="https://github.com/aquaproj/aqua-registry/actions/runs/19009066123/job/54292797683">3s</a>, <a href="https://github.com/aquaproj/aqua-registry/actions/runs/19009062660/job/54292795595">4s</a></td></tr>
</table>

The job has no slow steps

</details>

## Installation

See [INSTALL.md](INSTALL.md) for detailed installation instructions.

## Usage

For complete usage documentation, see [USAGE.md](USAGE.md).

### Prerequisites

A GitHub access token is required to download action logs. See [GitHub Access Token](#github-access-token) for details.

```sh
export GITHUB_TOKEN=xxx
```

### Analysis Modes

**1. Analyze multiple workflow runs** (recommended for performance insights)

```sh
ghaperf \
  --repo suzuki-shunsuke/ghaperf \
  --workflow test.yaml \
  --count 10 \
  --threshold 2s
```

> [!NOTE]
> Higher `--count` values provide better insights but take longer to process.

**2. Analyze a single workflow run**

```sh
ghaperf \
  --repo "suzuki-shunsuke/tfaction" \
  --run-id "<workflow run id>"
```

**3. Analyze a specific job**

```sh
ghaperf \
  --repo suzuki-shunsuke/tfaction \
  --job-id "<workflow job id>"
```

**4. Analyze a local log file**

```sh
ghaperf --log-file path/to/job.log
```

See the [example log file](testdata/log.txt) for format reference.

## Configuration

### Environment Variables

 Variable | Description | Default
---|---|---
`GHAPERF_LOG_LEVEL` | Log level: `debug`, `info`, `warn`, `error` | `info`
`GHAPERF_GITHUB_TOKEN` | GitHub access token | -
`GITHUB_TOKEN` | GitHub access token (alternative) | -
`GHAPERF_GHTKN` | Enable [ghtkn](https://github.com/suzuki-shunsuke/ghtkn) integration | `false`
`GHAPERF_THRESHOLD` | Default threshold for slow steps/log groups | `30s`

### GitHub Access Token

A GitHub access token is required to fetch workflow runs, jobs, and logs via the GitHub API.

> [!WARNING]
> Even if repositories are public, an access token is required.
> This is a known issue of GitHub.
> https://github.com/orgs/community/discussions/24742
>
> ```json
> {
>   "message": "Must have admin rights to Repository.",
>   "documentation_url": "https://docs.github.com/rest/actions/workflow-jobs#download-job-logs-for-a-workflow-run",
>   "status": "403"
> }
> ```
>
> The message says `Must have admin rights to Repository.`, but actually we confirmed the message is wrong because non admin user can download logs.

**Required Permissions:**
- Public repositories
  - Permissions to access action logs is required, but [they are ambiguous due to the bug of GitHub](https://github.com/orgs/community/discussions/24742). And there are sevel types of GitHub Access tokens, so it's a bit difficult to describe accurately
- Private repositories: `Actions: Read` permission

**Setup:**

```sh
# Option 1: Use GITHUB_TOKEN
export GITHUB_TOKEN=ghp_xxxxxxxxxxxxx

# Option 2: Use GHAPERF_GITHUB_TOKEN
export GHAPERF_GITHUB_TOKEN=ghp_xxxxxxxxxxxxx

# Option 3: Use ghtkn integration
export GHAPERF_GHTKN=true
```

### Threshold

ghaperf reports steps and log groups that exceed the specified threshold:

**Threshold Configuration:**
- Default: `30s`
- Set via `--threshold` flag or `GHAPERF_THRESHOLD` environment variable
- Format: [Go duration](https://pkg.go.dev/time#ParseDuration) (e.g., `1s`, `2m30s`)

### Configuration File

Use configuration files to filter jobs by job name and normalize job names.
All settings are optional.

Scaffold the configuration file:

```sh
ghaperf --init # Generate ghaperf.yaml
```

Pass the configuration file:

```sh
ghperf --config <configuration file path> ...
```

e.g.

```yaml
# Only analyze jobs matching these regular expressions
job_names:
  - "test / test / test .*"

# Exclude jobs matching these regular expressions
# excluded_job_names:
#   - "test / test / test .*"

# Normalize matrix job names for aggregation
job_name_mappings:
  "test / test / test .*": "test / test / test"
```

**Available Fields:**
- `job_names`: List of regular expressions - only matching jobs are analyzed
- `excluded_job_names`: List of regular expressions - matching jobs are excluded
- `job_name_mappings`: Map of regular expressions to normalized names for matrix jobs and old job names

**JSON Schema and Validation:**

The configuration schema is available at [json-schema/ghaperf.json](json-schema/ghaperf.json).

Validate your configuration with [ajv-cli](https://ajv.js.org/packages/ajv-cli.html):

```sh
ajv --spec=draft2020 -s json-schema/ghaperf.json -d ghaperf.yaml
```

**IDE Support:**

Enable auto-completion in your editor by adding this to your config file:

Latest version:

```yaml
# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/ghaperf/main/json-schema/ghaperf.json
```

Or pin to a specific version:

```
# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/ghaperf/v0.0.3/json-schema/ghaperf.json
```

## Advanced Topics

### Caching

ghaperf automatically caches API responses for completed workflow runs and jobs to improve performance on subsequent analyses.

**Cache location:** `${XDG_CACHE_HOME:-${HOME}/.cache}/ghaperf/`

This speeds up repeated analyses and reduces API calls.

### Group log lines

ref. [Group log lines](https://docs.github.com/en/actions/reference/workflows-and-actions/workflow-commands#grouping-log-lines)

By grouping log lines properly, you can analyze the performance using ghaperf more deeply.
Especially, if a specific step (run step, JavaScript Action, or Docker Action) is doing various things, you can analyze the bottlenecks inside them by grouping log lines properly.

## Important Notes

1. **Log availability timing:** Job logs must be fully processed by GitHub. If a job just completed, the API may not have logs ready yet. Wait a few moments and retry.

2. **Log format changes:** GitHub's log format is not officially documented. ghaperf parses logs based on observed patterns, which may break if GitHub changes the format unexpectedly.

3. **Log retention:** [GitHub retains workflow logs for 90 days by default](https://docs.github.com/en/organizations/managing-organization-settings/configuring-the-retention-period-for-github-actions-artifacts-and-logs-in-your-organization). Analysis of older runs may fail if logs have been deleted.

## Related Projects

While these tools are excellent for analyzing GitHub Actions performance, they don't provide step-level visibility into composite actions like ghaperf does.
We don't aim to replace these tools with ghaperf.
For this reason, it is not our intention to re-implement features already present in other tools, such as CIAnalyzer, in ghaperf.
Rather, ghaperf preserves features that other tools are missing.
Tools like CIAnalyzer are more suitable if you want to know how performance changes over the medium to long term.
On the other hand, ghaperf is more suitable if you want to investigate current performance bottlenecks in more detail.

- [GitHub Actions Performance Metrics](https://docs.github.com/en/actions/concepts/metrics#about-github-actions-performance-metrics) - Official GitHub metrics
- [actions-timeline](https://github.com/Kesin11/actions-timeline) - GitHub Actions to visualize timeline of a workflow job in a job summary
- [CIAnalyzer](https://github.com/Kesin11/CIAnalyzer) - Collect metrics to BigQuery
- Collect metrics to OpenTelemetry
  - [github_actions_otel_trace](https://github.com/Kesin11/github_actions_otel_trace) - Export traces to OpenTelemetry
  - [otel-export-trace-action](https://github.com/inception-health/otel-export-trace-action) - OpenTelemetry trace export
  - [workflow-telemetry-action](https://github.com/runforesight/workflow-telemetry-action)
  - [github-actions-opentelemetry](https://github.com/paper2/github-actions-opentelemetry)
